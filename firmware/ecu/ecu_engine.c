/**
 * @file ecu_engine.c
 * @brief Engine Routine code
 *
 * @addtogroup ENGINE
 * @{
 */

#include "ecu_includes.h"

adcsample_t adc_tps;

icucnt_t last_period, prev_last_period;
icucnt_t rpm, frequency, misstooth;

uint8_t toothcount;
uint8_t id_rpm, id_tps;

#if ENGINE_DATA_MEMORY
uint16_t inj_data_ms_perc[ENGINE_CDATA][ENGINE_CDATA];
uint16_t ign_data_off_deg[ENGINE_CDATA][ENGINE_CDATA];
uint16_t inj_ms_base, inj_open_time;
adcsample_t adc_tps_close,adc_tps_full;
#else
uint16_t inj_data_ms_perc[ENGINE_CDATA][ENGINE_CDATA]={
  // 500,	750, 1000, 1250, 1500, 2000, 2500, 3000, 4000, 5000, 6000, 7000
  {	44,	26,	13,	 4,	 0,	 0,	 0,	 0,	 0,	 0,	 0,	 0}, // 0
  {	26,	29,	33,	35,	37,	40,	42,	44,	51,	55,	57,	59}, // 10
  {	28,	30,	34,	37,	39,	41,	43,	45,	52,	56,	59,	61}, // 15
  {	29,	32,	36,	38,	40,	43,	45,	47,	54,	58,	60,	62}, // 20
  {	36,	38,	43,	45,	48,	50,	52,	54,	61,	65,	68,	70}, // 30
  {	38,	40,	44,	46,	48,	51,	54,	56,	63,	67,	70,	74}, // 40
  {	40,	42,	47,	48,	50,	52,	57,	57,	62,	70,	72,	74}, // 50
  {	42,	45,	50,	52,	55,	57,	62,	62,	69,	75,	77,	80}, // 60
  {	44,	47,	51,	53,	56,	59,	62,	62,	74,	79,	82,	84}, // 70
  {	45,	48,	52,	55,	57,	59,	64,	64,	74,	81,	82,	84}, // 80
  {	47,	49,	54,	97,	97,	97,	97,	97,	88,	88,	88,	88}, // 90
  {	48,	50,	57,	97,	97,	97,	97,	97,	88,	88,	88,	88}  // 100
};

uint16_t ign_data_off_deg[ENGINE_CDATA][ENGINE_CDATA]={
  // 500,	750, 1000, 1250, 1500, 2000, 2500, 3000, 4000, 5000, 6000, 7000
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 0
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 10
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 15
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 20
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 30
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 40
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 50
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 60
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 70
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 80
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}, // 90
  {	10,	15,	15,	18,	20,	22,	25,	25,	27,	27,	30,	30}  // 100
};

adcsample_t adc_tps_close=195,adc_tps_full=1395;
uint16_t inj_ms_base=5,inj_open_time=200;
#endif

/**  @} */


